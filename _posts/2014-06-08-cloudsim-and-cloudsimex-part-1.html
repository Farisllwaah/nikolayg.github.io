---
layout: post
title: CloudSim and CloudSimEx [Part 1]
date: 2014-06-08 00:51:53.000000000 +10:00
type: post
published: true
status: publish
categories:
- CloudSimEx
tags:
- CloudSim
- CloudSimEx
- Guava
- java
- Maven
- Simulation
meta:
  _wpas_done_all: '1'
  _wpcom_is_markdown: '1'
  geo_public: '0'
  _publicize_pending: '1'
  publicize_linkedin_url: http://www.linkedin.com/updates?discuss=&scope=30071619&stype=M&topic=5881039668681654272&type=U&a=g0SZ
  _wpas_skip_5385652: '1'
  publicize_twitter_user: nikolaygrozev
  publicize_twitter_url: http://t.co/icRXPw24iH
  _wpas_done_5385644: '1'
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:55056044;b:1;}}
  _wpas_done_5385639: '1'
  _wpas_skip_5385644: '1'
  _wpas_skip_5385639: '1'
  _oembed_894ecfab9a23b38c3e01119c6340cc0c: "{{unknown}}"
  _oembed_03b04f06f0d25833092ddc3b7c3a5e6e: "{{unknown}}"
  _oembed_1d95a680aabc3f514b15b9c557001855: "{{unknown}}"
  _oembed_b5547f81af0c08cb57eb48c597e3c54d: "{{unknown}}"
  _edit_last: '1'
  _kad_blog_head: default
  _kad_post_summery: default
  _kad_post_sidebar: 'yes'
  _kad_sidebar_choice: sidebar-primary
  _kad_blog_author: default
  _kad_blog_carousel_similar: default
author:
  login: nikolaygrozev
  email: nikolay.grozev@gmail.com
  display_name: nikolaygrozev
  first_name: ''
  last_name: ''
---
<h1>Introduction</h1>
<p><a href="http://www.cloudbus.org/cloudsim/">CloudSim</a> is one of the most popular Cloud infrastructure simulators and is used throughout academia and industry. Being one of its maintainers I often get emails with requests for new features. I also get quite a few emails about several CloudSim extensions that we <a href="https://237a3a5033b233626a9879c6495ec440cffa62db.googledrive.com/host/0B6RdIi8F-v-lbE0tQTFwUktmaWM/pdf/Performance%20Modelling%20and%20Simulation%20of%20Three-Tier%20Applications%20in%20Cloud%20and%20Multi-Cloud%20Environments.pdf">published a paper about (pdf)</a> last year. Thus I've started the <a href="https://github.com/Cloudslab/CloudSimEx">CloudSimEx</a> project, which brings some of these extensions together and in a series of posts I'll demo some of its functionalities.</p>
<p><strong><u>So what is CloudSimEx</u>?</strong> CloudSimEx is a set of CloudSim extensions making simulation development easier and enabling the modelling of new types of applications, not supported by CloudSim. Currently the following features are included:</p>
<ul>
<li>Web session modelling;</li>
<li>Better logging utilities;</li>
<li>Utilities for generating CSV files for statistical analysis;</li>
<li>Automatic id generation;</li>
<li>Modelling of disk operations;</li>
<li>Utilities for running multiple experiments in parallel;</li>
<li>Utilities for modelling network latencies;</li>
<li>MapReduce simulation.</li>
</ul>
<p>In this part I'll explain how to set up CloudSim and CloudSimEx in Eclipse and how to use some of its base utility functionalities.</p>
<h1>Prerequisites</h1>
<p>Before following this tutorial you should have JDK 7 and Maven 3.2 or later installed on your system. <del>CloudSim currently can not be built with Java 8, because of <a href="https://cwiki.apache.org/confluence/display/MAVEN/Java+8+Upgrade">some issues in the integration of Java 8 and Maven</a>.</del> <strong><span style="color:#ff0000;">Edit:</span></strong> Both CloudSim and CloudSimEx now compile with Java 7 and 8 as well.</p>
<p>Installation instructions for Java 7 and Maven can be found here:</p>
<ul>
<li><a href="http://docs.oracle.com/javase/7/docs/webnotes/install/">http://docs.oracle.com/javase/7/docs/webnotes/install/</a></li>
<li><a href="http://maven.apache.org/download.cgi#Installation">http://maven.apache.org/download.cgi#Installation</a></li>
</ul>
<p>You should also have installed <a href="https://www.eclipse.org/downloads/">Eclipse IDE Java EE Developers</a> and SVN and GIT clients. If you're unfamiliar with CloudSim itself, you can look at <a href="http://www.cloudbus.org/cloudsim/examples.html">these examples</a>.</p>
<h1>CloudSim SetUp</h1>
<p>As a first step we need to get CloudSim's code and build it. Navigate to a folder of choice and issue the following commands:</p>
<pre><code>git clone https://github.com/Cloudslab/cloudsim.git
cd cloudsim
mvn clean install
</code></pre>
<p>This should take some time and in the end you should see the resounding "BUILD SUCCESSFUL".</p>
<p>Before we open CloudSim in Eclipse, we need make a few settings in the IDE. By default Eclipse comes with an embedded installation of Maven, which is different that the one on the operating system. We need to tell Eclipse to use the already installed one. Otherwise building from the IDE and the terminal will be two different things. You can skip the next step if you have already done this. If not go to <u>Window</u> -> <u>Preferences</u> -> <u>Maven</u> -> <u>Installations</u> and add the location of your maven installation:</p>
<p>[caption id="attachment_273" align="aligncenter" width="340"]<img src="{{ site.baseurl }}/assets/mavenineclipse.png" alt="Maven Setup in Eclipse" width="340" class="size-full wp-image-273" /> Maven Setup in Eclipse[/caption]</p>
<p>Now we can import the CloudSim project into Eclipse. Go to <u>File</u> -> <u>Import</u> -> <u>Existing Maven Projects</u> and follow the wizard. You can use the following screenshots as a guideline:</p>
<p>[gallery ids="278,277,276,275"]</p>
<p>This should open the CloudSim projects in Eclipse.</p>
<h1>CloudSimEx SetUp</h1>
<p>After CloudSim is set, we can continue to set up CloudSimEx as well. The following commands do just that.</p>
<pre><code>git clone https://github.com/Cloudslab/CloudSimEx.git
cd CloudSimEx
mvn clean install
</code></pre>
<p>Again, if all is fine you should see "BUILD SUCCESSFUL" int your terminal. Next you can open the CloudSimEx projects in Eclipse. Again you need to go to <u>File</u> -> <u>Import</u> -> <u>Existing Maven Projects</u> and follow the wizard, as we did with CloudSim.</p>
<h1>Test Project</h1>
<p>Now that CloudSim and CloudSimEx are set up we can create a simple test project, in which we can experiment with them. Go to <u>File</u> -> <u>New</u> -> <u>Project...</u> -> <u>Maven Project</u> and follow the wizard to create a simple maven project. You can use the following screeshots as a guideline:</p>
<p>[gallery ids="286,284,285"]</p>
<p>After the project is created, open its <u>pom.xml</u> file and add the following dependencies inside the <u>
<project /></u> section:</p>
<pre><code class="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.cloudbus.cloudsim&lt;/groupId&gt;
        &lt;artifactId&gt;cloudsim&lt;/artifactId&gt;
        &lt;version&gt;3.1-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.cloudbus&lt;/groupId&gt;
        &lt;artifactId&gt;cloudsimex-core&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.cloudbus&lt;/groupId&gt;
        &lt;artifactId&gt;cloudsimex-geolocation&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.cloudbus&lt;/groupId&gt;
        &lt;artifactId&gt;cloudsimex-web&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.cloudbus&lt;/groupId&gt;
        &lt;artifactId&gt;cloudsimex-mapreduce&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p>Finally, you should make sure the Eclipse project is configured to use Java 7. Right click on the test project in the explorer, select <u>Properties</u>, and ensure that the Java compiler compliance level is set to 1.7, as in the following screenshot:</p>
<p>[caption id="attachment_307" align="aligncenter" width="340"]<img src="{{ site.baseurl }}/assets/test-project-properties.png" alt="Test Project Properties" width="340" class="size-full wp-image-307" /> Test Project Properties[/caption]</p>
<p>Now you can create a class with a main method in the new project and it can import all CloudSim and CloudSimEx classes. You're ready to go!</p>
<h1>ID generation</h1>
<p>CloudSim requires the end user to provide a lot of numerical ids for the simulation entities (e.g. cloudlets, VMs). This tends to be error prone. If you provide duplicate ids for entities of the same type (e.g. cloudlets) this will result in an insidious bug, as CloudSim won't give any warning. Moreover in complex simulations virtual machines and cloudlets (i.e. jobs) need to be created dynamically, and thus you'll need to maintain global counters for id generation.</p>
<p>To solve the problem I've created the simple utility class <a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-core/src/main/java/org/cloudbus/cloudsim/ex/util/Id.java">org.cloudbus.cloudsim.ex.util.Id</a>. It allows you to create unique ids per simulation entity type. For example the following code creates three cloudlets with unique ids:</p>
<pre><code class="java">Cloudlet cl1 = new Cloudlet(Id.pollId(Cloudlet.class), ... );
Cloudlet cl2 = new NetworkCloudlet(Id.pollId(NetworkCloudlet.class), ... );
Cloudlet cl3 = new NetworkCloudlet(Id.pollId(Cloudlet.class), ... );

System.out.println(cl1.getCloudletId());   // Prints 1
System.out.println(cl2.getCloudletId());   // Prints 2
System.out.println(cl3.getCloudletId());   // Prints 3
</code></pre>
<p>Note that the exact type that you pass to Id.pollId( ) does not matter, as long as it is a subtype of a CloudSim entity - e.g. cloudlet, VM or host. The implementation will automatically check if the type you pass is a cloudlet or something else and will return an appropriate id. For example In the above code it didn't matter if we call Id.pollId(Cloudlet.class) or Id.pollId(NetworkCloudlet.class), it would return a unique cloudlet id in all cases.</p>
<p>If you're developing classes that extend CloudSim entities, you can eliminate the need for ids altogether, by redefining their constructors. For example, the following code creates a custom cloudlet, that automatically creates its own id in the costructor, and its users won't need to bother with ids.</p>
<pre><code class="java">public class MyCloudlet extends Cloudlet {
    public MyCloudlet(...) {
        super(Id.pollId(getClass()), ...);
    }
}
</code></pre>
<p>In fact, this is the approach taken in all CloudSimEx classes. Thus in CloudSimEx you don't need to specify your own ids.</p>
<h1>CSV export of objects</h1>
<p>When developing CloudSim simulations people often need to export tabular (i.e. coma separated values or CSV) for further statistical analysis. For example you may want to export data about your jobs'/cloudlets' start, end and execution time in a CSV file, in order to compute statistics or perform numerical analysis with Excel, R, SAS or Matlab. Looping over all objects and their properties, taking care of column padding and so on can be a drag.</p>
<p>Enter the <a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-core/src/main/java/org/cloudbus/cloudsim/ex/util/TextUtil.java">TextUtil</a> class. Converting an object to a CSV line is now just a single line of code. Add another line and you've got yourself a header, as in this example:</p>
<pre><code class="java">Vm vm = new Vm(Id.pollId(Vm.class), .....);
// getCaptionLine - prints a header
System.out.println(TextUtil.getCaptionLine(Vm.class));
// getTxtLine - prints a CSV line
System.out.println(TextUtil.getTxtLine(vm));
</code></pre>
<p>By default TextUtil inspects all the properties (i.e. public no-arg get methods) of the class/object and concatenates them taking into account predefined formatting and padding options. You can modify the list and order of properties for a given class using the <a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-core/src/main/java/org/cloudbus/cloudsim/ex/util/Textualize.java">Textualize</a> annotation. The output of the above is:</p>
<pre><code>BeingInstantiated;     Bw;CloudletScheduler;CurrentAllocatedBw;CurrentAllocatedMips;CurrentAllocatedRam;CurrentAllocatedSize;CurrentRequestedBw;CurrentRequestedMaxMips;CurrentRequestedMips;CurrentRequestedRam;CurrentRequestedTotalMips;Host;     Id;InMigration;      Mips;NumberOfPes;    Ram;   Size;StateHistory;                 Uid; UserId;                 Vmm;Class
             true;   1000;   ref&lt;455659002&gt;;                 0;                null;                  0;                   0;              1000;                1000.00;               [...];                512;                  1000.00;null;      4;      false;   1000.00;          1;    512;  10000;       [...];                 0-4;      0;                 Xen;   Vm
</code></pre>
<p>TextUtil automatically converts references, arrays and collections to simple representations, so that the CSV line format is maintained.</p>
<p>Often you don't need all properties of an object in the CSV - you may only need 2 or 3 of them. Again this can be done with a single line of code. You just need to specify the names of the properties when invoking TextUtil:</p>
<pre><code class="java">Vm vm = new Vm(Id.pollId(Vm.class), .....);
String[] props = new String[] { "Bw", "CurrentRequestedRam" };
System.out.println(TextUtil.getCaptionLine(Vm.class, props));
System.out.println(TextUtil.getTxtLine(vm, props));
</code></pre>
<p>This code will only print the "<u>Bw</u>" and "<u>CurrentRequestedRam</u>" properties, defined by the <u>getBw</u> and <u>getCurrentRequestedRam</u> methods:</p>
<pre><code>     Bw;CurrentRequestedRam
   1000;                512
</code></pre>
<p>In all above examples, we used the default delimeter ";". All TextUtil methods are overloaded so that you can specify another delimiter if needed.</p>
<p>Finally, often you may need some derived characteristic/column in the CSV. For example, you may like to have a field in gigabytes instead of megabytes, or you may want to compute the difference between two fields in a new column. TextUtil allows you to define the so-called virtual properties. A virtual property is just a pair - a name and Function (from the <a href="http://code.google.com/p/guava-libraries/">guava</a> library) which defines its value. The following example shows how to define an additional virtual property "CurrentRequestedRamGB" and to print it in conjunction with the regular property "CurrentRequestedRam":</p>
<pre><code class="java">Vm vm = new Vm(Id.pollId(Vm.class), ...);

String[] props = new String[] { "CurrentRequestedRam" };

LinkedHashMap&lt;String, Function&lt;? extends Vm, String&gt;&gt; virtualProps = new LinkedHashMap&lt;&gt;();
virtualProps.put("CurrentRequestedRamGB", new Function&lt;Vm, String&gt;() {
   @Override public String apply(Vm v) {
     return String.valueOf(v.getCurrentRequestedRam() / 1024.0);
   }
});

System.out.println(TextUtil.getCaptionLine(Vm.class, props, virtualProps.keySet()));
System.out.println(TextUtil.getTxtLine(vm, props, virtualProps));
</code></pre>
<p>This prints:</p>
<pre><code>CurrentRequestedRam;CurrentRequestedRamGB
                512;                  0.5
</code></pre>
<h1>Custom Logging</h1>
<p>CloudSim's default <a href="http://code.google.com/p/cloudsim/source/browse/trunk/modules/cloudsim/src/main/java/org/cloudbus/cloudsim/Log.java">Log</a> implementation is designed only to print to the standard output. Hence CloudSimEx introduces a new logger called <a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-core/src/main/java/org/cloudbus/cloudsim/ex/util/CustomLog.java">CustomLog</a>. It follows the same design principle of the original Log, but has several new functionalities. It allows (i) output redirection to a file, (ii) flexible definition of log entry formats. Most importantly it plays well with TextUtil and can be used to easily create CSV files for analysis.</p>
<p>To begin with, you need to configure the logger with a set of properties. You would typically store them in a separate configuration file:</p>
<pre><code class="java">Properties props = new Properties();
try (InputStream is = Files.newInputStream(Paths.get("...your file..."))) {
    props.load(is);
}
CustomLog.configLogger(props);
</code></pre>
<p>The important properties are:</p>
<ul>
<li>FilePath - if present this property has the value of the target log file. If this property is not present, the log is written to the standard output.</li>
<li>LogLevel - each log message has a level. This property identifies the minimal log level that will be printed. Levels are as in standard java logging - see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/logging/Level.html">LogLevel</a>. If this property is not present, a default log level INFO is used.</li>
<li>LogCloudSimClock - a boolean proeprty. If "true" the current CloudSim simulation time will be included in every log entry.</li>
<li>LogReadableSimClock - a boolean property. If "true" the current CloudSim simulation time will be included in every log entry and it will be formatted in the "<em>days:hours:minutes:seconds</em>" format.</li>
<li>LogRealTimeClock - a boolean property. If "true" the actual system/computer time will be included in every log entry.</li>
<li>LogFormat - a list of get method names of the class <a href="http://docs.oracle.com/javase/7/docs/api/java/util/logging/LogRecord.html">LogRecord</a>. It allows you to specify what should compose your log entries. Typically you would specify just "<em><u>getMessage</u></em>" or "<em><u>getLevel;getMessage</u></em>".</li>
<li>ShutStandardLogger - a boolean property. If "true" it will shut CloudSim's standard logger. This is useful, when the standard logger generates too many log messages and causes the simulation execution to slow down significantly.</li>
</ul>
<p>Consider the following example:</p>
<pre><code>FilePath=/mydesktop/log.log
LogLevel=INFO
LogCloudSimClock=true
LogReadableSimClock=false
LogRealTimeClock=true
LogFormat=getMessage
ShutStandardLogger=true
</code></pre>
<p>Given this configuration, CustomLog will output only log entries with level higher than INFO, will print the current time, and the current CloudSim simulation time and will shut the standard CloudSim logger. The output will be written to the file <u>/mydesktop/log.log</u>. Thus if you call:</p>
<pre><code class="java">CustomLog.printf("Hello %s", "World");
</code></pre>
<p>the output in the file will be something like this.</p>
<pre><code>22:42:51          0.00    Hello World
</code></pre>
<p>If all you want to see is the message and not the current time, you need to switch <u>LogCloudSimClock</u> and <u>LogRealTimeClock</u> to "false".</p>
<p>At any point during the simulation you can redirect CustomLog to another file or the standard output, by simply calling one of the following:</p>
<pre><code class="java">// Redirects to stdout ...
CustomLog.redirectToConsole();

// Redirects to a file, overwrites it
CustomLog.redirectToFile("...your file...");

// Redirects to a file, appends to it
CustomLog.redirectToFile("...your file...", true);
</code></pre>
<p>CustomLog has a lot of convenient methods for printing and formatting log messages and you can explore to see what's there. As I mentioned it can use TextUtil to print well formatted CSV files. So if you have a list of objects (e.g. cloudlets or VMs) you can convert them to a CSV with a single line of code, by using the <u>printResults</u> method. The following example demonstrates this:</p>
<pre><code class="java">List &lt;Vm&gt; vms = ......

CustomLog.redirectToFile("... your CSV file ...");
CustomLog.printResults(Vm.class, vms);
</code></pre>
<p>The <u>printResults</u> method is overloaded, so it can take property names and virtual properties, analogously to TextUtil.</p>
<h1>Conclusion</h1>
<p>In this article we just scratched the surface, by introducing CloudSimEx, explaining how to install it and overviewing some of its basic functionalities. In subsequent articles I'll talk about how CloudSimEx allows for I/O operations simulation, web session modelling, running multiple experiments in parallel and utilities for modelling Internet latencies ... so stay tuned :)</p>
<h1>References</h1>
<ul>
<li><a href="http://www.cloudbus.org/cloudsim/">CloudSim official website</a></li>
<li><a href="https://github.com/Cloudslab/CloudSimEx">CloudSimEx on GitHub</a></li>
<li><a href="https://237a3a5033b233626a9879c6495ec440cffa62db.googledrive.com/host/0B6RdIi8F-v-lbE0tQTFwUktmaWM/pdf/Performance%20Modelling%20and%20Simulation%20of%20Three-Tier%20Applications%20in%20Cloud%20and%20Multi-Cloud%20Environments.pdf">Performance Modelling and Simulation of Three-Tier Applications in Cloud and Multi-Cloud Environments [PDF]</a></li>
</ul>
