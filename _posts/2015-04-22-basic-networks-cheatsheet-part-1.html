---
layout: post
title: 'Basic Networks: Cheatsheet [Part 1]'
date: 2015-04-22 21:54:00.000000000 +10:00
type: post
published: true
status: publish
categories:
- Miscellaneous
tags:
- bgp
- network
- ospf
- rip
meta:
  _wpas_done_all: '1'
  _wpcom_is_markdown: '1'
  publicize_google_plus_url: https://plus.google.com/+NikolayGrozev/posts/KgFK1DHVRGm
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _wpas_done_5385652: '1'
  _publicize_done_external: a:1:{s:11:"google_plus";a:1:{s:21:"116873873608085229608";b:1;}}
  publicize_twitter_user: nikolaygrozev
  publicize_twitter_url: http://t.co/gMcm0svVqC
  _wpas_done_5385644: '1'
  _wpas_linkedin_publicize_failure: ''
  publicize_linkedin_url: ''
  _publicize_job_id: '11450361869'
  _publicize_failed_5425643: ''
  _oembed_06769f5b0c7d967740498b60972d6fbb: "{{unknown}}"
  _oembed_19731d60a8396118762cacc5474c6405: "{{unknown}}"
  _oembed_2c603de168770c9bf53bf2ad8e433d00: "{{unknown}}"
  _oembed_01b05aebb38089957dfa70d9025b442f: "{{unknown}}"
  _edit_last: '1'
  _kad_blog_head: default
  _kad_post_summery: default
  _kad_post_sidebar: 'yes'
  _kad_sidebar_choice: sidebar-primary
  _kad_blog_author: default
  _kad_blog_carousel_similar: default
  _thumbnail_id: '416'
author:
  login: nikolaygrozev
  email: nikolay.grozev@gmail.com
  display_name: nikolaygrozev
  first_name: ''
  last_name: ''
---
<p>Present day distributed systems are based on technologies which abstract away the complexity of the underlying network. Software Engineers use middleware and programing APIs which completely mask how the underlying network works. Although this eases software development, programmers quite often have problems troubleshooting subtle performance quirks as they do not understand what happens “below” the programming abstractions.</p>
<p>The purpose of this cheat-sheet is to briefly overview the main networking principles without going into too much technical details. For more in-depth understanding you can refer to <a href="http://www.amazon.com/Computer-Networks-Edition-Andrew-Tanenbaum/dp/0132126958">Tanenbaum’s bible</a>.</p>
<h1>Routing</h1>
<h2>Basic Routing Theory</h2>
<p>The Internet consists of a number of <a href="http://en.wikipedia.org/wiki/Autonomous_system_%28Internet%29">Autonomous Systems</a> (AS), which in term consist of one or multiple subnetworks. Typically an AS is owned and exploited by a single large-scale organisation – e.g. an ISP. Routing protocols enable hosts to communicate efficiently regardless of which network they are in.</p>
<p>Routing protocols can be divided in two groups with respect to whether they route traffic within or across AS:</p>
<ul>
<li>Interior Gateway Protocols – route within an AS;</li>
<li>Exterior Gateway Protocols – route across AS networks.</li>
</ul>
<p>With respect to the used routing technique, protocols can also be divided into:</p>
<ul>
<li>Distance Vector protocols – each router maintains a lookup table mapping destination addresses with the most suitable “next step” in the routing. Routers exchange data only with their adjacent routers, which update their tables accordingly. Usually based on the <a href="http://en.wikipedia.org/wiki/Bellman%E2%80%93Ford_algorithm">Ford-Bellman algorithm</a>.</li>
<li>Link State protocols – each router “knows” the states of all links in the network and routes accordingly. Changes are broadcasted to all routers. Based on <a href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s algorithm</a>.</li>
</ul>
<p>The above routing methods are generic and can use any distance measure – e.g. number of hops or latency. Typically, distance vector protocols scale better as they do not flood the entire network with network state data.</p>
<p>Finally, routing protocols can also be classified as:</p>
<ul>
<li>Classful – when routers do not include subnet masks in their messages. Routers use the <a href="http://en.wikipedia.org/wiki/Classful_network">legacy IP classes</a> to determine subnet and host addresses.</li>
<li>Classless - when routers exchange subnet information together with the destination addresses.</li>
</ul>
<p>Modern protocols tend to be classless.</p>
<p>Routing is typically hierarchical, meaning that each network can be divided into subnetworks. Each subnet has two types of routers – internal and border. Internal routers route traffic within the network, while border routers route to and from other networks from the same level in the hierarchy.</p>
<p>Network devices (like routers) typically communicate through <a href="http://en.wikipedia.org/wiki/Transmission_Control_Protocol">TCP</a> or <a href="http://en.wikipedia.org/wiki/User_Datagram_Protocol">UDP</a>. In case something goes wrong, network admins need a way to “debug” what has happened. Enter Internet Control Message Protocol (ICMP) which is used just for that. One notable example is the <u>ping</u> command, which uses ICMP to check the connection to a host.</p>
<h2>Large scale routing (Exterior Gateway Protocol)</h2>
<p>Routing between Autonomous Systems (AS) is handled by the Border Gateway Protocol (BGP). It is pretty much the only Exterior Gateway Protocol in use these days. Each AS is given an Id number so it can be uniquely identified. Within each AS a few routers are designated to manage the traffic with other AS networks. They are known as “Autonomous System Boundary Routers” (ASBR). BGP is classified as a distance vector protocol. However the designated BGP routers within each AS keep the entire path to each destination AS. Thus for each destination the neighbouring routers exchange entire paths, not just the next best hop. BGP is classless.</p>
<h2>Smaller Scale routing (Interior Gateway Protocols)</h2>
<p>Open Shortest Path First (OSPF) is a link state classless protocol used to route data within an AS. Each router maintains a complete weighted graph of the network and runs <a href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s algorithm</a> to determine the path for each packet. Each router’s graph is built by exchanging graphs with the adjacent routers or vial multicast if the network supports that.</p>
<p>OSPF can manage big networks (an entire AS) and thus is hierarchical and can consist of smaller networks called areas. Each area has an Area Border Router (ABR) which represents it in the OSPF routing. The internal structure of area is not known to the OSPF routers.</p>
<p>The Intermediate System to Intermediate System (IS-IS) protocol is conceptually very similar OSPF, the main difference being that it does <a href="http://en.wikipedia.org/wiki/IS-IS#Comparison_with_OSPF">not use IP addresses</a>. This is why it is less widely adopted.</p>
<p>The Routing Information Protocol (RIP) can also be used to route within an AS, but it does not scale as well as OSPF. It is a distance vector protocol and distances are exchanged periodically (usually every 30 seconds). Its first version was classful, but the later ones are classless.</p>
<p>[caption id="attachment_416" align="aligncenter" width="640"]<img src="{{ site.baseurl }}/assets/as.jpg" alt="Autonomous Systems" width="640" height="456" class="size-full wp-image-416" /> Autonomous Systems[/caption]</p>
<h1>Network Addresses</h1>
<p>To function networks need to give each host a unique address. Usually this is the notorious IPv4 address. Because of hierarchical routing (i.e. networks are divided into subnets), each IP address is divided in two parts – the network id and the host id.</p>
<p>Routing is performed based on the network address (i.e. from one network into another) until the destination network is achieved. At this point the respective router can directly send the package to the host, using the host portion of the IP address.</p>
<p>Back in the day IP addresses were <a href="http://en.wikipedia.org/wiki/Classful_network">divided into classes</a>. Each class can be recognised by a specific sequence of bits in the address’ start. Each class would define which part of the address is a subnet mask and which is the host address. This mechanism turned out to be wasteful and was eventually deprecated.</p>
<p>Presently arbitrary subnet address are used (i.e. Classless Inter-Domain Routing, CIDR), and this can be included in the IPv4 notation as well. For example 152.121.183.34<u>/21</u> means that the first 21 bits are the network address, and the rest are the host address.</p>
<p>Network routing works with IP addresses, but local area networks (like Ethernet or WiFi) work with physical Media Access Control (MAC) addresses. A MAC address is 6 bytes and can be recorded in one of the following formats: <u>01-23-45-67-89-ab</u>; <u>01:23:45:67:89:ab</u> or <u>0123.4567.89ab</u>. So we need to map between MAC and IP addresses. Enter the Address Resolution Protocol (ARP). Each host in the LAN keeps a dictionary of MACs and IPs in the network. Whenever an unknown IP address comes in, a special ARP message with the IP is broadcasted. The machine with the IP in question responds in order to notify the rest of the hosts to update their dictionaries. The <a href="http://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbor Discovery Protocol</a> (NDP) is similar to ARP but it works with IPv6.</p>
<p>The IPv4 address space can have only 2<sup>32</sup> (4,294,967,296) addresses, which obviously is insufficient for all devices connecting to the Internet. One way to solve this problem is not to assign a static IP address to every connected device – i.e. to reuse a pool of IP addresses and dynamically assign them to devices joining the network. Also static IP addresses are problematic when a device is moved from one network to another. Enter the Dynamic Host Configuration Protocol (DHCP). Once a new machines joins a network it broadcast a request to find the dedicated DHCP server, which responds with its IP address. If there is no DHCP address on the local network, one of the hosts on the network (known as DHCP agent) transmits the messages between the newly added machine and an external DHCP server.</p>
<p>Another way to mitigate the shortage of IPv4 address is to use Network Address Translation (NAT). In this case every device in a subnet is given a “hidden” IP address, which may not be globally unique. Usually the private IP addresses are in the forma 192.168.X.X or 10.X.X.X. These IP ranges are “reserved” for private (e.g. NAT-ed) networks and can not be used in the public internet. All devices’ communication passes through a NAT device (e.g. a router) which overwrites the source IP address with its own and changes the outbound port uniquely, so that when data is received back on this port, the NAT device knows who the recipient is. As a consequence a server outside the NAT-ed network can not start communication with a machine behind NAT, unless the machine has started it first. Otherwise, the external server would not know which port to send to.</p>
<p>[caption id="attachment_417" align="aligncenter" width="987"]<img src="{{ site.baseurl }}/assets/nat.jpg" alt="NAT" width="987" height="467" class="size-full wp-image-417" /> NAT[/caption]</p>
<p>NAT is basically a hack to work around the issue of limited IPv4 addresses. A better approach would be to move to IPv6, which would allow all devices to have a static IPs. IPv6 addresses are 16 bytes (128 bits) and are in the form: 2001:0db8:85a3:0042:1000:8a2e:0370:7334.</p>
<p>Resources:</p>
<ul>
<li><a href="https://www.youtube.com/user/technologyaddict405/videos">https://www.youtube.com/user/technologyaddict405/videos</a></li>
<li><a href="http://en.wikibooks.org/wiki/Communication_Networks/Routing">http://en.wikibooks.org/wiki/Communication_Networks/Routing</a></li>
</ul>
