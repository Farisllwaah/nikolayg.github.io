---
layout: post
title: CloudSim and CloudSimEx [Part 3] – Delayed VM and Cloudlet actions
date: 2014-09-13 03:43:30.000000000 +10:00
type: post
published: true
status: publish
categories:
- CloudSimEx
tags:
- CloudSim
- CloudSimEx
- DatacenterBrokerEX
- Delay
- java
- virtual machine
- VM
meta:
  _wpas_done_all: '1'
  _wpcom_is_markdown: '1'
  _wpas_skip_facebook: '1'
  _wpas_skip_tumblr: '1'
  _wpas_skip_path: '1'
  _publicize_pending: '1'
  publicize_google_plus_url: https://plus.google.com/116873873608085229608/posts/WKwrkwC4Zh9
  _wpas_done_5385652: '1'
  _publicize_done_external: a:1:{s:11:"google_plus";a:1:{s:21:"116873873608085229608";b:1;}}
  publicize_twitter_user: nikolaygrozev
  publicize_twitter_url: http://t.co/zSyKNghRKz
  _wpas_done_5385644: '1'
  publicize_linkedin_url: ''
  _wpas_done_5385639: '1'
  _wpas_skip_5385652: '1'
  _wpas_skip_5385644: '1'
  _wpas_skip_5385639: '1'
  _edit_last: '1'
  _kad_blog_head: default
  _kad_post_summery: default
  _kad_post_sidebar: 'yes'
  _kad_sidebar_choice: sidebar-primary
  _kad_blog_author: default
  _kad_blog_carousel_similar: default
author:
  login: nikolaygrozev
  email: nikolay.grozev@gmail.com
  display_name: nikolaygrozev
  first_name: ''
  last_name: ''
---
<h1>Introduction</h1>
<p>Quite a few CloudSim users have asked on the mailing lists how to submit/destroy a VM or a cloudlet with a delay. Unfortunately, this is not straightforward in CloudSim, and users have to develop a custom broker and override several methods to achieve this. This is far from trivial, as it involves launching and handling custom events and ensuring the internal state of the broker is consistent - e.g. all cloudlets of a terminated VM are killed.</p>
<p>That's why CloudSimEx introduced a new broker <a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-core/src/main/java/org/cloudbus/cloudsim/ex/DatacenterBrokerEX.java">DatacenterBrokerEX</a>, which among other new features also supports dynamic provisioning and scheduling of VMs and cloudlets.</p>
<h1>Prerequisites</h1>
<p>I assume you’ve already worked through Part 1 of this series. If not, now is a good time to check it out – <a href="www.nikgrozev.net/2014/06/08/cloudsim-and-cloudsimex-part-1/">CloudSim and CloudSimEx [Part 1]</a>.</p>
<h1>Some Code Please</h1>
<p>To demonstrate how the delayed actions work, we modify <a href="https://code.google.com/p/cloudsim/source/browse/trunk/modules/cloudsim-examples/src/main/java/org/cloudbus/cloudsim/examples/CloudSimExample1.java">CloudSimExample1</a>, which simply creates a VM and schedules a cloudlet on it. Our modification starts the VM with a 2 seconds delay, and destroys it with a 500 secs delay. Also, we delay the cloudlet submission with 10 secs. The full code of the example can be found in the class <a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-examples/src/main/java/org/cloudbus/cloudsim/ex/DelayExample1.java">DelayExample1</a>. Below we will focus only on the usage of the functionalities.</p>
<p>First we need to use a broker of type <a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-core/src/main/java/org/cloudbus/cloudsim/ex/DatacenterBrokerEX.java">DatacenterBrokerEX</a> (or a subclass):</p>
<pre><code class="java">DatacenterBrokerEX broker = new DatacenterBrokerEX("Broker", 1000);
</code></pre>
<p>Note that the new broker has an additional parameter called <u>lifeLength</u>. Standard CloudSim brokers are terminated whenever there are no more running cloudlets/jobs. If the simulated system becomes idle for a period of time (i.e. no cloudlets are run) the broker and the simulation will be terminated! To overcome this issues <a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-core/src/main/java/org/cloudbus/cloudsim/ex/DatacenterBrokerEX.java">DatacenterBrokerEX</a> introduces this new parameter called <u>lifeLength</u>, and ensures that the simulation and the broker are not terminated before <u>lifeLength</u> seconds have passed, even if there are no running cloudlets. In the previous code we want the broker to be alive for lifeLength=1000 secs, even if there is an idle period.</p>
<p>After creating the broker, we can go on to instantiate the VM and the clouldlet, as we would in a typical CloudSim program. The interesting part is the creation and destruction of VMs with a delay:</p>
<pre><code class="java">// submit vm to the broker after 2 seconds
broker.createVmsAfter(Arrays.asList(vm), 2);
// destroy VM after 500 seconds
broker.destroyVMsAfter(Arrays.asList(vm), 500);
</code></pre>
<p>The above code will submit the VM 2 seconds afterwards, and will terminate it 500 secs later. Analogously, the following code will submit the cloudlet with a delay of 10 secs:</p>
<pre><code class="java">broker.submitCloudletList(Arrays.asList(cloudlet), 10);
</code></pre>
<p>If we look at the standard output of CloudSim, we can verify that:</p>
<pre><code>2.0: Broker: Trying to Create VM #0 in Datacenter_0
2.1: Broker: VM #0 has been created in Datacenter #2, Host #0
10.0: Broker: Sending cloudlet 0 to VM #0
410.0: Broker: Cloudlet 0 received
500.0: Broker: Trying to Destroy VM #0 in Datacenter_0
500.0: Broker: VM #0 has been destroyed in Datacenter #2
</code></pre>
<p>Moreover if we schedule the termination of the VM before the completion of the cloudlet, its status will be set appropriately to <u>Cloudlet.FAILED_RESOURCE_UNAVAILABLE</u>.</p>
<h1>Use Cases</h1>
<p>So how is this useful? Well, it allows us to easily define execution scenarios in advance before the simulation start. We can predefine that the workload (i.e. cloudlets) will occur at a given time to test an autostaling policy, or that VMs will fail at specific times to test fail over policies. And most importantly we can do this with just a few lines of code.</p>
<p><a href="https://github.com/Cloudslab/CloudSimEx/blob/master/cloudsimex-core/src/main/java/org/cloudbus/cloudsim/ex/DatacenterBrokerEX.java">DatacenterBrokerEX</a> and its subclasses have other useful features as well, so stay tuned for future posts!</p>
